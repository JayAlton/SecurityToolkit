import re

def identify_services(services):
    fingerprints = []
    for port, banner in services:
        service = "unknown"
        version = "unknown"

        banner = banner.strip()
        if "OpenSSH" in banner.lower():
            service = "OpenSSH"
            version = extract_version(banner)
        elif "Apache" in banner.lower():
            service = "apache"
            version = extract_version(banner)
        elif "nginx" in banner.lower():
            service = "nginx"
            version = extract_version(banner)
        elif "Microsoft-IIS" in banner.lower():
            service = "iis"
            version = extract_version(banner)

        fingerprints.append({
            "port": port,
            "service": service,
            "version": version
            })
    return fingerprints

def extract_version(banner):
    match = re.search(r"\d+\.\d+(?:\.\d+)?(?:[a-zA-Z0-9]+)?", banner)
    return match.group(0) if match else "unknown"
